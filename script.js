let photos = [
    {
    name: "jalan",
    url: "alam.jpg",
    alt: "Pantai",
    category: "Alam"
  },
  {
    name: "gunung",
    url: "gunung.jpg",
    alt: "Gunung",
    category: "Alam"
  },
  {
    name: "kota",
    url: "kota.jpg",
    alt: "Kota",
    category: "Kota"
  },
  {
    name: "hutan",
    url: "hutan.jpg",
    alt: "Hutan",
    category: "Alam"
  },
  {
    name: "anak",
    url: "anak.jpg",
    alt: "anak kecil",
    category: "anak"
  },
  {
  name: "anak",
  url: "anak1.jpg",
  alt: "anak kecil",
  category: "anak"
},
{
  name: "cuaca",
  url: "alam1.jpg",
  alt: "kota",
  category: "alam"
},
{
  name: "cuaca",
  url: "alam2.jpg",
  alt: "kota",
  category: "alam"
},
{
  name: "cuaca",
  url: "alam3.jpg",
  alt: "kota",
  category: "alam"
},
{
  name: "cuaca",
  url: "alam4.jpg",
  alt: "kota",
  category: "alam"
},
{
  name: "jalan",
  url: "alam5.jpg",
  alt: "kota",
  category: "alam"
},
{
  name: "gunung",
  url: "gunung1.jpg",
  alt: "kota",
  category: "alam"
},
{
  name: "kota",
  url: "kota1.jpg",
  alt: "kota",
  category: "alam"
},
{
  name: "kota",
  url: "kota2.jpg",
  alt: "kota",
  category: "alam"
},
{
  name: "hutan",
  url: "hutan1.jpg",
  alt: "Hutan",
  category: "Alam"
},
{
  name: "anime",
  url: "anime.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Idol",
  url: "idol.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "anime",
  url: "anime1.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis1.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Idol",
  url: "idol1.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "anime",
  url: "anime2.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis2.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Idol",
  url: "idol2.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "anime",
  url: "anime3.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis3.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Idol",
  url: "idol3.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "anime",
  url: "anime4.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis4.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Idol",
  url: "idol4.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "anime",
  url: "anime5.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis5.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Idol",
  url: "idol5.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "anime",
  url: "anime6.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis6.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Idol",
  url: "idol6.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "anime",
  url: "anime7.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis7.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Idol",
  url: "idol7.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "anime",
  url: "anime8.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis8.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Idol",
  url: "idol8.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "anime",
  url: "anime9.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis9.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Idol",
  url: "idol9.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "anime",
  url: "anime10.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis10.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Anime",
  url: "anime26.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Idol",
  url: "idol10.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "anime",
  url: "anime11.jpg",
  alt: "anime",
  category: "anime"
},
{
  name: "Artis",
  url: "artis11.jpg",
  alt: "artis",
  category: "artis"
},
{
  name: "Anime",
  url: "anime25.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Idol",
  url: "idol11.jpg",
  alt: "idol",
  category: "idol"
},
{
  name: "Anime",
  url: "anime24.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Gfx",
  url: "gfx.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Anime",
  url: "anime23.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Meme",
  url: "meme.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Gfx",
  url: "gfx1.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Anime",
  url: "anime22.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Meme",
  url: "meme1.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Gfx",
  url: "gfx2.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Anime",
  url: "anime21.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Meme",
  url: "meme2.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Gfx",
  url: "gfx3.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Anime",
  url: "anime20.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Meme",
  url: "meme3.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Gfx",
  url: "gfx4.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Anime",
  url: "anime19.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Meme",
  url: "meme4.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Gfx",
  url: "gfx5.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Anime",
  url: "anime18.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Meme",
  url: "meme5.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Gfx",
  url: "gfx6.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Anime",
  url: "anime17.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Meme",
  url: "meme6.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Gfx",
  url: "gfx7.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Anime",
  url: "anime16.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Meme",
  url: "meme7.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Gfx",
  url: "gfx8.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Anime",
  url: "anime15.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Meme",
  url: "meme8.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Gfx",
  url: "gfx9.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Anime",
  url: "anime14.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Meme",
  url: "meme9.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Gfx",
  url: "gfx10.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Meme",
  url: "meme10.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Anime",
  url: "anime13.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Gfx",
  url: "gfx11.jpg",
  alt: "bahan edit",
  category: "gfx"
},
{
  name: "Anime",
  url: "anime12.jpg",
  alt: "Anime",
  category: "anime"
},
{
  name: "Meme",
  url: "meme11.jpg",
  alt: "meme",
  category: "meme"
},
{
  name: "Anime",
  url: "anime.mp4",
  alt: "anime",
  category: "anime",
  type: "video"
},
{
  name: "Cosplay",
  url: "cosplay.mp4",
  alt: "anime",
  category: "cosplay",
  type: "video"
},
{
  name: "Cosplay",
  url: "cosplay1.mp4",
  alt: "anime",
  category: "cosplay",
  type: "video"
},
];

const gallery = document.getElementById("gallery");
const searchInput = document.getElementById("searchInput");
const filterCategory = document.getElementById("filterCategory");
const photoCount = document.getElementById("photoCount");

function renderPhotos() {
  const keyword = searchInput.value.toLowerCase();
  const category = filterCategory.value;

  gallery.innerHTML = "";

  const filtered = photos.filter(p => {
    const matchName = p.name.toLowerCase().includes(keyword);
    const matchCategory = !category || p.category === category;
    return matchName && matchCategory;
  });

  filtered.forEach(photo => {
    const card = document.createElement("div");
    card.className = "photo-card";
    card.dataset.name = photo.name;

    if (photo.type === "video") {
  card.innerHTML = `
    <video src="${photo.url}" controls></video>
    <div class="photo-actions">
      <button onclick="downloadMedia('${photo.url}', '${photo.alt || 'video'}')">Download</button>
    </div>
  `;
} else {
  card.innerHTML = `
    <img src="${photo.url}" alt="${photo.alt}" />
    <div class="photo-actions">
      <button onclick="downloadImage(this)">Download</button>
    </div>
  `;
}

    const media = card.querySelector("img, video");
if (media) {
  media.addEventListener("click", () => openLightbox(photo.url));
}
    gallery.appendChild(card);
  });

  photoCount.textContent = `Total Foto: ${filtered.length}`;
}

function downloadImage(button) {
  const img = button.closest('.photo-card').querySelector('img');
  const link = document.createElement('a');
  link.href = img.src;
  link.download = img.alt || 'foto';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
function downloadMedia(url, filename) {
  const link = document.createElement('a');
  link.href = url;
  link.download = filename;
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function openLightbox(url) {
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightbox-img");
  
  if (url.endsWith(".mp4") || url.endsWith(".webm")) {
    lightboxImg.outerHTML = `<video id="lightbox-img" controls autoplay><source src="${url}" type="video/mp4"></video>`;
  } else {
    lightboxImg.outerHTML = `<img id="lightbox-img" src="${url}" alt="Preview" />`;
  }
  
  lightbox.style.display = "flex";
}

function closeLightbox() {
  document.getElementById("lightbox").style.display = "none";
}

searchInput.addEventListener("input", renderPhotos);
filterCategory.addEventListener("change", renderPhotos);

function downloadAll() {
  photos.forEach(photo => {
    const link = document.createElement('a');
    link.href = photo.url;
    link.download = photo.alt || 'foto';
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  });
}

document.getElementById("uploadInput").addEventListener("change", function () {
  const files = [...this.files];
  files.forEach(file => {
    const url = URL.createObjectURL(file);
    const name = file.name.split(".")[0];
    photos.push({
      name,
      url,
      alt: name,
      category: "Lokal"
    });
  });
  renderPhotos();
});

function toggleMode() {
  document.body.classList.toggle("light-mode");
}

// Load awal
renderPhotos();
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
let deferredPrompt;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  
  // Tampilkan tombol custom install
  const installBtn = document.createElement('button');
  installBtn.textContent = 'Install MoeGallery';
  installBtn.id = 'installBtn';
  document.body.appendChild(installBtn);
  
  installBtn.addEventListener('click', () => {
    installBtn.remove();
    deferredPrompt.prompt();
    deferredPrompt.userChoice.then((choiceResult) => {
      if (choiceResult.outcome === 'accepted') {
        console.log('Aplikasi diinstal!');
      } else {
        console.log('Pengguna batal instal');
      }
      deferredPrompt = null;
    });
  });
});
